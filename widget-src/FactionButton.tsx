import { WIDGET_SPACING, WIDGET_COLOR_ALLIANCE, WIDGET_COLOR_HORDE, WIDGET_COLOR_GOLD, WIDGET_FACTION_BUTTON_WIDTH, WIDGET_VOTE_BUTTON_HEIGHT, WIDGET_VOTE_BUTTON_CORNER_RADIUS } from "./constants";

const { widget } = figma;
const { AutoLayout, Ellipse, SVG, Text } = widget;

interface FactionButtonProps {
  faction: Faction;
  factionCount: any;
  winning: boolean;
  x: number;
  y: number;
  setFactionCount(factionCount: any): void;
}

const FactionButton = ({
  faction,
  factionCount,
  winning,
  x,
  y,
  setFactionCount
}: FactionButtonProps) => {

  const winningIcon = `
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M9.33333 28V25.3333H14.6667V21.2C13.5778 20.9556 12.6056 20.4944 11.75 19.8167C10.8944 19.1389 10.2667 18.2889 9.86667 17.2667C8.2 17.0667 6.80556 16.3389 5.68333 15.0833C4.56111 13.8278 4 12.3556 4 10.6667V9.33333C4 8.6 4.26111 7.97222 4.78333 7.45C5.30556 6.92778 5.93333 6.66667 6.66667 6.66667H9.33333V4H22.6667V6.66667H25.3333C26.0667 6.66667 26.6944 6.92778 27.2167 7.45C27.7389 7.97222 28 8.6 28 9.33333V10.6667C28 12.3556 27.4389 13.8278 26.3167 15.0833C25.1944 16.3389 23.8 17.0667 22.1333 17.2667C21.7333 18.2889 21.1056 19.1389 20.25 19.8167C19.3944 20.4944 18.4222 20.9556 17.3333 21.2V25.3333H22.6667V28H9.33333ZM9.33333 14.4V9.33333H6.66667V10.6667C6.66667 11.5111 6.91111 12.2722 7.4 12.95C7.88889 13.6278 8.53333 14.1111 9.33333 14.4ZM16 18.6667C17.1111 18.6667 18.0556 18.2778 18.8333 17.5C19.6111 16.7222 20 15.7778 20 14.6667V6.66667H12V14.6667C12 15.7778 12.3889 16.7222 13.1667 17.5C13.9444 18.2778 14.8889 18.6667 16 18.6667ZM22.6667 14.4C23.4667 14.1111 24.1111 13.6278 24.6 12.95C25.0889 12.2722 25.3333 11.5111 25.3333 10.6667V9.33333H22.6667V14.4Z" fill="black"/>
    </svg>
  `;

  const factions = {
    horde: {
      displayName: "Horde",
      icon: `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
          <g xmlns="http://www.w3.org/2000/svg" id="horde" fill="${WIDGET_COLOR_HORDE}">
            <path d="M31.918 12.877c13.893 3.155 12.677 15.606 8.909 20.167-3.77 4.559-5.351 10.961-5.351 10.961-1.666 10.96.262 19.555.262 19.555 2.631-3.77 7.279-13.853 7.279-13.853-2.891 1.053-4.293 0-4.471-2.722-.176-2.718 1.58-7.451 4.471-9.646 2.892-2.191 6.666 1.318 6.666 1.318 2.455-2.37 8.156-12.629 8.156-12.629s.64-.263-3.511 2.718c-4.144 2.984-6.134 1.93-6.134 1.93-1.142-4.998 6.134-9.821 6.134-9.821-.086-.877-6.4-8.068-6.4-8.068s-1.049-6.4-1.756-6.926c-.698-.528-4.995 1.927-4.995 1.927L31.917.334l-9.152 7.454s-4.296-2.455-4.994-1.927c-.704.526-1.759 6.926-1.759 6.926s-6.311 7.19-6.399 8.068c0 0 7.278 4.823 6.135 9.821 0 0-1.99 1.054-6.135-1.93-4.149-2.982-3.51-2.718-3.51-2.718s5.703 10.259 8.155 12.629c0 0 3.775-3.508 6.667-1.318 2.892 2.195 4.647 6.929 4.473 9.646-.179 2.722-1.581 3.774-4.473 2.722 0 0 4.647 10.083 7.28 13.853 0 0 1.927-8.595.263-19.555 0 0-1.582-6.401-5.353-10.961-3.77-4.562-5.249-17.012 8.645-20.167h.158z"/>
            <path d="M31.926 30.281c.223-.043.564-.306.564-.306l5.352-6.71s-3.287-4.517-4.475-5.962c-1.182-1.447-1.441-1.183-1.441-1.183h.044s-.256-.264-1.438 1.183c-1.186 1.445-4.476 5.962-4.476 5.962l5.351 6.71s.339.263.562.306"/>
          </g>
        </svg>
      `,
      color: WIDGET_COLOR_HORDE
    },
    alliance: {
      displayName: "Alliance",
      icon: `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
          <g xmlns="http://www.w3.org/2000/svg" id="alliance" fill="${WIDGET_COLOR_ALLIANCE}">
            <path d="M31.611 4.723c.502.1.777.77.777.77v2.979c5.669-2.512 6.337-2.005 6.337-2.005s-1.057.978-.168 2.361c.889 1.389 3.869.675 3.869.675-.223 1.849 3.466 2.924 5.801 1.947 2.334-.974 5.336-.31 5.336-.31-1.337-1.9-7.39-.563-8.616-1.283-1.22-.719 1.946-1.746 1.946-1.746s-2.444.463-4.446 0c-1.998-.464.613-1.334.613-1.334-1.168 0-1.611-.771-1.611-.771-.389-1.541 2.889-1.743 2.889-1.743-3.835-.878-5.781.768-7.782 1.024-2.001.258-1.527-.872-1.527-.872.415-1.49 3.418-1.517 3.418-1.517-1.557-.748-3.724-.075-4.391-.024-.668.051-.441 0-.441 0L31.611 0h-.194L29.42 2.873s.222.051-.447 0c-.667-.051-2.833-.724-4.391.024 0 0 3.002.027 3.418 1.517 0 0 .474 1.13-1.527.872-2.003-.256-3.949-1.902-7.783-1.024 0 0 3.279.202 2.891 1.743 0 0-.445.771-1.611.771 0 0 2.612.871.61 1.334-2.003.463-4.447 0-4.447 0s3.169 1.027 1.946 1.746c-1.222.719-7.279-.617-8.615 1.283 0 0 3.001-.664 5.335.31 2.334.977 6.026-.098 5.802-1.947 0 0 2.98.715 3.867-.675.89-1.383-.166-2.361-.166-2.361s.669-.507 6.339 2.005V5.493s.277-.67.775-.77h.195zM14.578 13.04s-.832-1.281-1.945-.77c-1.11.515-.943 2.002-.943 2.002s-5.006 4.47-4.06 8.063c0 0 .167.72 1.279 1.233l.111 1.182s1.28.156 1.001 1.028c-.277.875-.723 4.724-.556 6.883.168 2.154 0 3.75 0 3.75s-1.834.152-1.612 1.796c.226 1.645 2.726 1.439 3.445.359.725-1.076 2.059-6.056 6.672-5.186 0 0-.868-2.619-6.26-.461 0 0-1.279-10.942 6.115-12.842 0 0-1.613-.664-3.948.055 0 0-.332-1.339-2.333-1.388 0 0 .644-2.98 3.146-4.415 0 0 1.552.255 1.946-.516.388-.773-2.058-.773-2.058-.773z"/>
            <path d="M7.798 26.188c-.598 0-.888.872-.774 1.44.11.563.774 1.953.774 1.953s.056-1.286.334-1.695c.279-.416.832-1.698-.334-1.698zM29.028 17.768s-3.945-3.44-4.89-3.44c-.946 0-2.501 1.795-3.001 3.079-.501 1.286-1.113 3.648 1.446 4.827 2.556 1.181 2.944 1.441 3.054 2.054.11.618.222 1.85-.779 2.67-.996.821-3.276 2.874-2.385 5.289.886 2.415 2.888 6.009 6.279 5.496 3.39-.511 1.554-4.466 1.554-4.466s-3.109-3.442-2.832-5.908c.275-2.463 1.444-5.854 1.831-6.366.39-.512-.943.052-1.388.206-.443.155-2.28 1.335-3.502-.566-1.222-1.899-1.277-3.391-.498-3.8.776-.41 1.278 0 2.943.926 1.67.925 2.058 1.283 2.556 1.131.501-.157-.045-.838-.388-1.132zM34.698 17.768s3.943-3.44 4.89-3.44c.945 0 2.499 1.795 3.002 3.079.499 1.286 1.11 3.648-1.447 4.827-2.557 1.181-2.944 1.441-3.058 2.054-.111.618-.219 1.85.778 2.67 1 .821 3.279 2.874 2.391 5.289-.89 2.415-2.89 6.009-6.28 5.496-3.391-.511-1.555-4.466-1.555-4.466s3.109-3.442 2.834-5.908c-.279-2.463-1.446-5.854-1.834-6.366-.39-.512.943.052 1.391.206.444.155 2.276 1.335 3.499-.566 1.225-1.899 1.279-3.391.5-3.8-.778-.41-1.278 0-2.942.926-1.669.925-2.059 1.283-2.558 1.131-.504-.157.044-.838.389-1.132zM31.976 46.476c0-.409.277-2.362.946-2.209.672.153 1.273 1.953 1.31.821.032-1.13 2.132-3.851 2.242-4.571.114-.718-.607-.718-2.278-1.106-1.667-.393-2.219-1.975-2.219-1.975h-.226s-.554 1.582-2.222 1.975c-1.668.389-2.39.389-2.278 1.106.114.719 2.211 3.441 2.244 4.571.034 1.132.637-.668 1.305-.821.675-.153.95 1.8.95 2.209h.226z"/>
            <path d="M31.862 27.268s3-.26 2.889 1.18c-.11 1.44-2.776 4.061-2.776 4.061h-.226s-2.667-2.62-2.776-4.061c-.111-1.44 2.889-1.18 2.889-1.18zM31.056 20.565s-1.415 2.362-1.443 3.363c-.028 1.004.028 1.235.304 1.569.278.332 2.446.77 4.029 0 0 0 .584-.335.278-1.672-.308-1.331-1.528-3.26-1.528-3.26s.389 2.057.361 3.11c-.028 1.051-.556.973-.833 1.024-.276.051-1.178.157-1.425-.541-.241-.692.257-3.593.257-3.593zM30.799 11.91s-.549.36-.577.593A45.692 45.692 0 0 1 30 13.888c-.055.332-.61 1.08-.555 1.695.055.617 1.362 2.13 2.279 2.237.916.102 2.263-.928 2.59-2.184 0 0 .162-.437-.562-1.308-.723-.876.009-1.824-.831-2.417l-.282 3.132s-.567.49-.756.619c-.186.129-.632-.457-.715-.793-.082-.339-.369-2.959-.369-2.959zM17.218 34.829s-1.333-.54-2.501.964c-1.167 1.501-1.874 4.353-1.791 5.278 0 0-1.21-.194-1.709.189 0 0 .832.236.919.466.082.231-2.878 1.462-3.214 2.967-.33 1.501 1.417 2.196 1.544 2.153.127-.037-.292-.807-.375-1.463-.083-.654.668-1.576 1.668-1.425 0 0 .459 1.771 1.501 1.425 0 0-1.412-2.039-.519-2.736.893-.691 1.35.772 1.35.772s1.046 2.504.378 4.931l-.209.309s.959-.388 1.46-1.58c0 0 1.708 1.465 2.626 3.773.918 2.315.918 3.276.959 3.431.042.151.332 1.693.625-.656.292-2.35.209-4.469 1.585-5.431 1.375-.962 1.625-.886 2.167-.538.541.346 1.167.808 1.749.346.583-.464.167-1.734-.791-1.695-.958.038-2.66-.698-5.245 2.309 0 0-1.168-.422-2.208-2.772-1.042-2.348-2.627-6.778-1.335-9.435 0 0 .827.771 1.616-.04.793-.809-.25-1.542-.25-1.542zM49.182 13.04s.833-1.281 1.943-.77c1.113.515.945 2.002.945 2.002s5 4.47 4.059 8.063c0 0-.165.72-1.28 1.233l-.108 1.181s-1.28.156-1.001 1.028c.278.875.719 4.724.555 6.883-.167 2.154 0 3.75 0 3.75s1.833.152 1.613 1.796c-.225 1.645-2.725 1.439-3.447.359-.722-1.076-2.055-6.056-6.669-5.186 0 0 .868-2.619 6.26-.461 0 0 1.277-10.942-6.117-12.842 0 0 1.614-.664 3.95.055 0 0 .331-1.339 2.334-1.388 0 0-.646-2.98-3.149-4.415 0 0-1.558.255-1.944-.516-.388-.772 2.056-.772 2.056-.772z"/>
            <path d="M55.96 26.188c.6 0 .893.872.779 1.44-.11.563-.779 1.953-.779 1.953s-.053-1.286-.332-1.695c-.277-.416-.832-1.698.332-1.698zM46.542 34.829s1.335-.54 2.502.964c1.167 1.501 1.873 4.353 1.79 5.278 0 0 1.208-.194 1.711.189 0 0-.835.236-.917.466-.082.231 2.873 1.462 3.21 2.967.333 1.501-1.417 2.196-1.544 2.153-.126-.037.293-.807.376-1.463.084-.654-.668-1.576-1.668-1.425 0 0-.456 1.771-1.501 1.425 0 0 1.412-2.039.517-2.736-.892-.691-1.351.772-1.351.772s-1.038 2.504-.373 4.931l.208.309s-.96-.388-1.459-1.58c0 0-1.708 1.465-2.625 3.773-.917 2.315-.917 3.276-.958 3.431-.042.151-.335 1.693-.627-.656-.294-2.35-.209-4.469-1.583-5.431-1.375-.962-1.627-.886-2.169-.538-.539.346-1.168.808-1.748.346-.586-.464-.168-1.734.79-1.695.958.038 2.661-.698 5.244 2.309 0 0 1.167-.422 2.21-2.772 1.042-2.348 2.626-6.778 1.333-9.435 0 0-.826.771-1.62-.04-.79-.809.252-1.542.252-1.542z"/>
            <path d="M41.331 50.431c-.219-.181-.062-.514-.007-1.232.056-.719-.28 0-.28 0-.874.885-1.173 1.615-1.173 1.615-.21 1.774-1.419 3.816-3.292 5.537-1.878 1.719-3.911 2.745-4.118 2.932a.496.496 0 0 1-.278.121v-.005s-.077.015-.175.019c-.099-.005-.173-.019-.173-.019v.005a.492.492 0 0 1-.28-.121c-.207-.188-2.241-1.213-4.118-2.932-1.875-1.722-3.082-3.763-3.293-5.537 0 0-.299-.729-1.173-1.615 0 0-.333-.719-.277 0 .055.719.209 1.052-.007 1.232-.792.652-1.551 1.154-1.426 2.042.124.885.376 1.54.624 1.81.25.267.836.636.836.636s-1.752-2.871-.377-2.756c0 0 .667-.039 1.46 1.464.789 1.501.622 1.926 1.168 2.579.54.655 1.083 1.389 1.292 1.618.208.23.456 0 .208.23-.253.233-.417.233-.375.771.042.541.122 2.043.291 2.273.165.233.373.385.498 0 .125-.386.044-1.732.918-1.657.876.076 1.252.425 1.46.617.207.194.833.502.833.502s-2.045 1.886-2.001 2.388c.042.499-.126.73.124.846.253.114 1.045-.195 1.669-.734.624-.538 1.485-1.305 1.973-1.383h.29c.487.078 1.351.845 1.974 1.383.624.539 1.417.848 1.667.734.25-.116.084-.347.124-.846.042-.502-2.001-2.388-2.001-2.388s.629-.308.835-.502c.209-.192.586-.54 1.46-.617.876-.076.794 1.271.917 1.657.126.385.334.233.502 0 .165-.23.248-1.732.292-2.273.042-.539-.128-.539-.375-.771-.253-.23 0 0 .203-.23.214-.229.753-.964 1.294-1.618.543-.654.377-1.078 1.168-2.579.792-1.504 1.46-1.464 1.46-1.464 1.374-.115-.376 2.756-.376 2.756s.584-.369.834-.636c.25-.27.502-.925.625-1.81.127-.888-.634-1.39-1.424-2.042z"/>
          </g>
        </svg>
      `,
      color: WIDGET_COLOR_ALLIANCE
    }
  }

  const handleClick = () => {
    setFactionCount(factionCount + 1);
  }

  return (
    <AutoLayout 
      positioning="absolute"
      verticalAlignItems="center"
      overflow="visible"
      spacing="auto"
      width={WIDGET_FACTION_BUTTON_WIDTH}
      height={WIDGET_VOTE_BUTTON_HEIGHT}
      padding={24}
      x={x}
      y={y}
      cornerRadius={WIDGET_VOTE_BUTTON_CORNER_RADIUS}
      fill={{
        r: 0,
        g: 0,
        b: 0,
        a: 0.75
      }}
      effect={{
        type: "background-blur",
        blur: 20,
      }}
      hoverStyle={{
        stroke: 
        {
          r: 1,
          g: 1,
          b: 1,
          a: 0.5
        }
      }}
      strokeWidth={2}
      onClick={handleClick}>
      <AutoLayout
        spacing={WIDGET_SPACING}
        verticalAlignItems="center">
        <SVG 
          src={factions[faction].icon}
          width={56}
          height={56} />
        <Text
          fontFamily="Inter"
          fontSize={24}
          lineHeight={48}
          fontWeight={700}
          fill={"#ffffff"}>
          {`For the ${factions[faction].displayName}!`}
        </Text>
      </AutoLayout>
      <AutoLayout
        horizontalAlignItems="end"
        width={48}
        height={48}>
        <AutoLayout
          width={48}
          height={48}
          horizontalAlignItems="center"
          verticalAlignItems="center">
          <Ellipse
            positioning="absolute"
            width={48}
            height={48}
            fill={factions[faction].color} />
          <Text
            fontFamily="Inter"
            fontSize={24}
            lineHeight={48}
            fontWeight={700}
            fill={"#ffffff"}>
            {factionCount}
          </Text>
        </AutoLayout>
      </AutoLayout>
      {
        winning
        ? <AutoLayout
            positioning="absolute"
            width={48}
            height={48}
            horizontalAlignItems="center"
            verticalAlignItems="center"
            x={faction === 'alliance' ? -24 : WIDGET_FACTION_BUTTON_WIDTH - 24}
            y={-24}>
            <Ellipse
              positioning="absolute"
              width={48}
              height={48}
              fill={WIDGET_COLOR_GOLD} />
            <SVG
              src={winningIcon}
              width={32}
              height={32} />
          </AutoLayout>
        : null
      }
    </AutoLayout>
  )
}

export default FactionButton;